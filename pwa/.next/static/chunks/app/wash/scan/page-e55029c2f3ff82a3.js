(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[88],{5172:function(e,t,a){Promise.resolve().then(a.bind(a,2354))},2354:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var s=a(7437),r=a(29),n=a.n(r),o=a(2265),i=a(9376),l=a(8094),c=a(1837);function d(){let e=(0,i.useRouter)(),[t,a]=(0,o.useState)(null),[r,d]=(0,o.useState)(null),[f,h]=(0,o.useState)(""),[x,m]=(0,o.useState)(!1),[u,b]=(0,o.useState)(""),[j,p]=(0,o.useState)(!1);(0,o.useRef)(null);let[y,w]=(0,o.useState)(!1),[v,g]=(0,o.useState)("");(0,o.useEffect)(()=>{let t=(0,l.Gg)(),s=(0,l.L$)();if(!t||!s){e.replace("/login");return}d(t),a(s),N()},[e]);let N=async()=>{try{(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind).length>0&&w(!0)}catch(e){g("Camera access not available"),p(!0)}},k=async()=>{if(r&&f.trim()){m(!0),b("");try{let t=await c.h.getLocationByCode(r,f.toUpperCase().trim());e.push("/wash/new?location=".concat(t.code))}catch(e){b(e.message||"Location not found"),m(!1)}}};return t?(0,s.jsxs)("div",{className:"jsx-4254a5f451248b60 min-h-screen bg-gray-900 flex flex-col",children:[(0,s.jsx)("header",{className:"jsx-4254a5f451248b60 bg-gray-900/80 backdrop-blur text-white px-4 py-4 safe-area-top absolute top-0 left-0 right-0 z-10",children:(0,s.jsxs)("div",{className:"jsx-4254a5f451248b60 flex items-center gap-4",children:[(0,s.jsx)("button",{onClick:()=>{e.back()},className:"jsx-4254a5f451248b60 p-2 hover:bg-gray-800 rounded-lg transition-colors",children:(0,s.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-4254a5f451248b60 w-6 h-6",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7",className:"jsx-4254a5f451248b60"})})}),(0,s.jsxs)("div",{className:"jsx-4254a5f451248b60",children:[(0,s.jsx)("h1",{className:"jsx-4254a5f451248b60 text-lg font-semibold",children:"Scan QR Code"}),(0,s.jsx)("p",{className:"jsx-4254a5f451248b60 text-gray-400 text-sm",children:"Point at location QR code"})]})]})}),(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 flex-1 flex items-center justify-center relative",children:j?(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 w-full px-6",children:(0,s.jsxs)("div",{className:"jsx-4254a5f451248b60 bg-white rounded-2xl shadow-xl p-6",children:[(0,s.jsx)("h2",{className:"jsx-4254a5f451248b60 text-xl font-semibold text-gray-800 text-center mb-6",children:"Enter Location Code"}),u&&(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm text-center",children:u}),(0,s.jsx)("input",{type:"text",value:f,onChange:e=>h(e.target.value.toUpperCase()),placeholder:"WASH001",autoCapitalize:"characters",autoComplete:"off",autoFocus:!0,className:"jsx-4254a5f451248b60 w-full px-4 py-4 text-2xl text-center font-mono tracking-wider\n                           border-2 border-gray-200 rounded-xl\n                           focus:border-primary-500 focus:ring-4 focus:ring-primary-100\n                           transition-all uppercase"}),(0,s.jsxs)("div",{className:"jsx-4254a5f451248b60 mt-6 space-y-3",children:[(0,s.jsx)("button",{onClick:k,disabled:x||!f.trim(),className:"jsx-4254a5f451248b60 w-full py-4 bg-gradient-to-r from-primary-500 to-primary-700\n                             text-white font-semibold rounded-xl shadow-lg\n                             hover:from-primary-600 hover:to-primary-800\n                             active:scale-[0.98] transition-all\n                             disabled:opacity-50 disabled:cursor-not-allowed",children:x?(0,s.jsxs)("span",{className:"jsx-4254a5f451248b60 flex items-center justify-center gap-2",children:[(0,s.jsxs)("svg",{fill:"none",viewBox:"0 0 24 24",className:"jsx-4254a5f451248b60 animate-spin w-5 h-5",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",className:"jsx-4254a5f451248b60 opacity-25"}),(0,s.jsx)("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",className:"jsx-4254a5f451248b60 opacity-75"})]}),"Looking up..."]}):"Find Location"}),(0,s.jsx)("button",{onClick:()=>p(!1),className:"jsx-4254a5f451248b60 w-full py-3 text-gray-600 font-medium\n                             hover:text-gray-800 transition-colors",children:"Back to Scanner"})]})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 absolute inset-0 flex items-center justify-center",children:y?(0,s.jsxs)("div",{className:"jsx-4254a5f451248b60 relative",children:[(0,s.jsxs)("div",{className:"jsx-4254a5f451248b60 w-64 h-64 relative",children:[(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-primary-500 rounded-tl-lg"}),(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-primary-500 rounded-tr-lg"}),(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-primary-500 rounded-bl-lg"}),(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-primary-500 rounded-br-lg"}),(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 absolute inset-4 overflow-hidden",children:(0,s.jsx)("div",{style:{animation:"scan 2s ease-in-out infinite"},className:"jsx-4254a5f451248b60 w-full h-0.5 bg-primary-500 animate-pulse"})})]}),(0,s.jsx)("p",{className:"jsx-4254a5f451248b60 text-white text-center mt-8 text-sm",children:"QR scanner coming soon"})]}):(0,s.jsxs)("div",{className:"jsx-4254a5f451248b60 text-center text-white px-8",children:[(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsxs)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-4254a5f451248b60 w-8 h-8 text-gray-500",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z",className:"jsx-4254a5f451248b60"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z",className:"jsx-4254a5f451248b60"})]})}),(0,s.jsx)("p",{className:"jsx-4254a5f451248b60 text-gray-400",children:v||"Camera not available"})]})}),(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 absolute bottom-24 left-0 right-0 px-4",children:(0,s.jsx)("button",{onClick:()=>p(!0),className:"jsx-4254a5f451248b60 w-full py-4 bg-white/10 backdrop-blur text-white font-semibold rounded-xl\n                           hover:bg-white/20 active:scale-[0.98] transition-all",children:"Enter Code Manually"})})]})}),(0,s.jsx)("div",{className:"jsx-4254a5f451248b60 safe-area-bottom bg-gray-900"}),(0,s.jsx)(n(),{id:"4254a5f451248b60",children:"@-webkit-keyframes scan{0%,100%{-webkit-transform:translatey(0);transform:translatey(0)}50%{-webkit-transform:translatey(200px);transform:translatey(200px)}}@-moz-keyframes scan{0%,100%{-moz-transform:translatey(0);transform:translatey(0)}50%{-moz-transform:translatey(200px);transform:translatey(200px)}}@-o-keyframes scan{0%,100%{-o-transform:translatey(0);transform:translatey(0)}50%{-o-transform:translatey(200px);transform:translatey(200px)}}@keyframes scan{0%,100%{-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}50%{-webkit-transform:translatey(200px);-moz-transform:translatey(200px);-o-transform:translatey(200px);transform:translatey(200px)}}"})]}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Loading..."})})}},1837:function(e,t,a){"use strict";a.d(t,{h:function(){return n}});let s=a(257).env.NEXT_PUBLIC_API_URL||"";class r{async activate(e,t){let a=await fetch("".concat(this.baseUrl,"/pwa/activate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inviteCode:e,pin:t})});if(!a.ok)throw Error((await a.json()).message||"Activation failed");return a.json()}async getProfile(e){let t=await fetch("".concat(this.baseUrl,"/pwa/profile"),{headers:{"x-driver-session":e}});if(!t.ok)throw Error("Failed to get profile");return t.json()}async getLocations(e){let t=await fetch("".concat(this.baseUrl,"/pwa/locations"),{headers:{"x-driver-session":e}});if(!t.ok)throw Error("Failed to get locations");return t.json()}async getLocationByCode(e,t){let a=await fetch("".concat(this.baseUrl,"/pwa/locations/").concat(t),{headers:{"x-driver-session":e}});if(!a.ok)throw Error("Location not found");return a.json()}async getServices(e,t){let a=await fetch("".concat(this.baseUrl,"/pwa/locations/").concat(t,"/services"),{headers:{"x-driver-session":e}});if(!a.ok)throw Error("Failed to get services");return a.json()}async createWashEvent(e,t){let a=await fetch("".concat(this.baseUrl,"/pwa/wash-events"),{method:"POST",headers:{"Content-Type":"application/json","x-driver-session":e},body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json()).message||"Failed to create wash event");return a.json()}async startWashEvent(e,t){let a=await fetch("".concat(this.baseUrl,"/pwa/wash-events/").concat(t,"/start"),{method:"POST",headers:{"x-driver-session":e}});if(!a.ok)throw Error((await a.json()).message||"Failed to start wash");return a.json()}async completeWashEvent(e,t){let a=await fetch("".concat(this.baseUrl,"/pwa/wash-events/").concat(t,"/complete"),{method:"POST",headers:{"x-driver-session":e}});if(!a.ok)throw Error((await a.json()).message||"Failed to complete wash");return a.json()}async getActiveWashEvent(e){let t=await fetch("".concat(this.baseUrl,"/pwa/wash-events/active"),{headers:{"x-driver-session":e}});if(404===t.status)return null;if(!t.ok)throw Error("Failed to get active wash event");return t.json()}async getWashEvent(e,t){let a=await fetch("".concat(this.baseUrl,"/pwa/wash-events/").concat(t),{headers:{"x-driver-session":e}});if(!a.ok)throw Error((await a.json()).message||"Failed to get wash event");return a.json()}async getWashHistory(e){let t=await fetch("".concat(this.baseUrl,"/pwa/wash-events"),{headers:{"x-driver-session":e}});if(!t.ok)throw Error("Failed to get wash history");return t.json()}constructor(){this.baseUrl=s}}let n=new r},8094:function(e,t,a){"use strict";a.d(t,{Aj:function(){return n},Gg:function(){return o},L$:function(){return i},Ov:function(){return l},jl:function(){return c}});let s="vsys_session",r="vsys_driver";function n(e,t){localStorage.setItem(s,e),localStorage.setItem(r,JSON.stringify(t))}function o(){return localStorage.getItem(s)}function i(){{let e=localStorage.getItem(r);if(e)return JSON.parse(e)}return null}function l(){localStorage.removeItem(s),localStorage.removeItem(r)}function c(){return null!==o()}}},function(e){e.O(0,[847,971,117,744],function(){return e(e.s=5172)}),_N_E=e.O()}]);